# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "Payment creation failed"

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:
```
‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞: Payment creation failed
```

## –ü—Ä–∏—á–∏–Ω–∞

–ò–∑–Ω–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π REST API –ü—Ä–æ–¥–∞–º—É—Å. –°–æ–≥–ª–∞—Å–Ω–æ [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ü—Ä–æ–¥–∞–º—É—Å](https://help.prodamus.ru/payform/integracii/rest-api/instrukcii-dlya-samostoyatelnaya-integracii-servisov#parametry-kotorye-vy-mozhete-peredat-v-zaprose), —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ —Å HMAC –ø–æ–¥–ø–∏—Å—å—é.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω ProdamusService

- ‚úÖ –£–¥–∞–ª–µ–Ω –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π REST API
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è HMAC –ø–æ–¥–ø–∏—Å—å
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ webhook –ø–æ–¥–ø–∏—Å–µ–π

### 2. –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- ‚ùå `PRODAMUS_API_KEY` (–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ü—Ä–æ–¥–∞–º—É—Å)
- ‚úÖ `PRODAMUS_SHOP_ID` (ID –º–∞–≥–∞–∑–∏–Ω–∞)
- ‚úÖ `PRODAMUS_SECRET_KEY` (—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á)
- ‚úÖ `PRODAMUS_PAYMENT_FORM_URL` (URL –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Ñ–æ—Ä–º—ã)

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhook

- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ (`Sign` –≤–º–µ—Å—Ç–æ `x-prodamus-signature`)
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö webhook
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –û–±–Ω–æ–≤–∏—Ç–µ .env —Ñ–∞–π–ª

```env
# Prodamus Configuration
PRODAMUS_SHOP_ID=your_shop_id          # ID –≤–∞—à–µ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞ –≤ –ü—Ä–æ–¥–∞–º—É—Å
PRODAMUS_SECRET_KEY=your_secret_key    # –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
PRODAMUS_PAYMENT_FORM_URL=https://payform.ru/pay
PRODAMUS_WEBHOOK_URL=https://yourdomain.com/webhook/prodamus
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ü—Ä–æ–¥–∞–º—É—Å

1. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ü—Ä–æ–¥–∞–º—É—Å
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **ID –º–∞–≥–∞–∑–∏–Ω–∞** (sys) ‚Üí `PRODAMUS_SHOP_ID`
   - **–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á** ‚Üí `PRODAMUS_SECRET_KEY`
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ URL –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: `https://yourdomain.com/webhook/prodamus`

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞:

```bash
npm run test:payment
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
‚úÖ –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!
üîó URL: https://payform.ru/pay?do=pay&sys=your_shop_id&...
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `npm start`
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/subscribe`
3. –ù–∞–∂–º–∏—Ç–µ "–û–ø–ª–∞—Ç–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É"
4. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ webhook'–æ–≤ –æ—Ç –ü—Ä–æ–¥–∞–º—É—Å
3. –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–Ω–∞–ª—É

## –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ –±–æ—Ç–∞

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
pm2 logs telegram-bot

# –ò–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ npm
npm start
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
node -e "require('dotenv').config(); console.log('SHOP_ID:', process.env.PRODAMUS_SHOP_ID); console.log('SECRET_KEY:', process.env.PRODAMUS_SECRET_KEY ? 'SET' : 'NOT SET');"
```

### –¢–µ—Å—Ç HMAC –ø–æ–¥–ø–∏—Å–∏

```bash
npm run test:payment
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. "Invalid signature"

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `PRODAMUS_SECRET_KEY`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ webhook URL –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ –ü—Ä–æ–¥–∞–º—É—Å

### 2. "User ID not found"

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `custom_fields` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –ø–ª–∞—Ç–µ–∂–Ω—É—é —Å—Å—ã–ª–∫—É
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ webhook –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

### 3. "Payment not successful"

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ü—Ä–æ–¥–∞–º—É—Å
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ü—Ä–æ–¥–∞–º—É—Å](https://help.prodamus.ru/payform/integracii/rest-api/instrukcii-dlya-samostoyatelnaya-integracii-servisov)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook'–æ–≤](https://help.prodamus.ru/payform/integracii/rest-api/instrukcii-dlya-samostoyatelnaya-integracii-servisov#parametry-kotorye-vy-mozhete-peredat-v-zaprose)
- [–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ü—Ä–æ–¥–∞–º—É—Å](https://prodamus.ru/support)
