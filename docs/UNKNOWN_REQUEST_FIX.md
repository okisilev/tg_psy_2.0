# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å" –≤ –ü—Ä–æ–¥–∞–º—É—Å

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Å—ã–ª–∫–µ –Ω–∞ –æ–ø–ª–∞—Ç—É –≤ –ü—Ä–æ–¥–∞–º—É—Å –ø–æ—è–≤–ª—è–ª–∞—Å—å –æ—à–∏–±–∫–∞:
```
–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å
```

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Å–æ–∑–¥–∞–Ω–∏—é —Å—Å—ã–ª–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API –ü—Ä–æ–¥–∞–º—É—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏ —á–µ—Ä–µ–∑ HTTP –∑–∞–ø—Ä–æ—Å—ã.

**–†–µ—à–µ–Ω–∏–µ:** –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –≤—Ä—É—á–Ω—É—é —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**–ë—ã–ª–æ:**
```javascript
const data = {
    do: 'pay',  // ‚Üê –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
    client_email: `${userId}@telegram.user`,
    success_url: `${process.env.WEBHOOK_URL}/success`,
    failure_url: `${process.env.WEBHOOK_URL}/failure`,
    custom_fields: JSON.stringify({
        telegram_user_id: userId
    })
};
```

**–°—Ç–∞–ª–æ:**
```javascript
const data = {
    do: 'link',  // ‚Üê –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    customer_email: `${userId}@telegram.user`,
    urlReturn: `${process.env.WEBHOOK_URL}/success`,
    urlSuccess: `${process.env.WEBHOOK_URL}/success`,
    customer_extra: JSON.stringify({
        telegram_user_id: userId
    })
};
```

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** API –ü—Ä–æ–¥–∞–º—É—Å –≤–æ–∑–≤—Ä–∞—â–∞–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É.

**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–∫–ª—é—á–µ–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–∞ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –≤—Ä—É—á–Ω—É—é.

```javascript
// –ë—ã–ª–æ:
const paymentUrl = await this.createPaymentLink(data);

// –°—Ç–∞–ª–æ:
const paymentUrl = this.buildPaymentUrl(data);
```

### 2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–°–æ–≥–ª–∞—Å–Ω–æ [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ü—Ä–æ–¥–∞–º—É—Å](https://help.prodamus.ru/payform/integracii/tekhnicheskaya-dokumentaciya-po-avtoplatezham/formirovanie-ssylki-na-oplatu):

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|----------|----------|---------|
| `do` | –î–µ–π—Å—Ç–≤–∏–µ (—Å–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏) | `link` |
| `sys` | ID –º–∞–≥–∞–∑–∏–Ω–∞ | `dashastar` |
| `order_id` | –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ | `42229` |
| `amount` | –°—É–º–º–∞ | `1000` |
| `currency` | –í–∞–ª—é—Ç–∞ | `RUB` |
| `description` | –û–ø–∏—Å–∞–Ω–∏–µ | `–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∑–∞–∫—Ä—ã—Ç—ã–π –∫–∞–Ω–∞–ª` |
| `customer_email` | Email –∫–ª–∏–µ–Ω—Ç–∞ | `431292182@telegram.user` |
| `urlReturn` | URL –≤–æ–∑–≤—Ä–∞—Ç–∞ | `https://dashastar.pagekite.me/success` |
| `urlSuccess` | URL —É—Å–ø–µ—Ö–∞ | `https://dashastar.pagekite.me/success` |
| `webhook_url` | Webhook URL | `https://dashastar.pagekite.me/sales/prodamus` |
| `customer_extra` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è | `{"telegram_user_id":431292182}` |
| `signature` | HMAC –ø–æ–¥–ø–∏—Å—å | `687a263291de013436c92eaf3b53da377ec1790a996c8d52fa806190b7b0bb3a` |

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞

```
https://dashastar.payform.ru/pay?do=link&sys=dashastar&order_id=42229&amount=1000&currency=RUB&description=–ü–æ–¥–ø–∏—Å–∫–∞+–Ω–∞+–∑–∞–∫—Ä—ã—Ç—ã–π+–∫–∞–Ω–∞–ª+%2830+–¥–Ω–µ–π%29&customer_email=431292182%40telegram.user&urlReturn=https%3A%2F%2Fdashastar.pagekite.me%2Fsuccess&urlSuccess=https%3A%2F%2Fdashastar.pagekite.me%2Fsuccess&webhook_url=https%3A%2F%2Fdashastar.pagekite.me%2Fsales%2Fprodamus&customer_extra=%7B%22telegram_user_id%22%3A431292182%7D&signature=687a263291de013436c92eaf3b53da377ec1790a996c8d52fa806190b7b0bb3a
```

### üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –°—Ç–∞—Ç—É—Å |
|----------|----------------|-------------------|---------|
| **do** | `pay` | `link` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| **email** | `client_email` | `customer_email` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| **success** | `success_url` | `urlSuccess` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| **return** | `failure_url` | `urlReturn` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| **extra** | `custom_fields` | `customer_extra` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Å—ã–ª–∫–∏

```bash
npm run test:payment
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!
üîó URL: https://dashastar.payform.ru/pay?do=link&sys=dashastar&order_id=...
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

```bash
# –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
node -e "
const url = 'https://dashastar.payform.ru/pay?do=link&sys=dashastar&order_id=42229&amount=1000&currency=RUB&description=–ü–æ–¥–ø–∏—Å–∫–∞+–Ω–∞+–∑–∞–∫—Ä—ã—Ç—ã–π+–∫–∞–Ω–∞–ª+%2830+–¥–Ω–µ–π%29&customer_email=431292182%40telegram.user&urlReturn=https%3A%2F%2Fdashastar.pagekite.me%2Fsuccess&urlSuccess=https%3A%2F%2Fdashastar.pagekite.me%2Fsuccess&webhook_url=https%3A%2F%2Fdashastar.pagekite.me%2Fsales%2Fprodamus&customer_extra=%7B%22telegram_user_id%22%3A431292182%7D&signature=687a263291de013436c92eaf3b53da377ec1790a996c8d52fa806190b7b0bb3a';
const params = new URLSearchParams(url.split('?')[1]);
for (const [key, value] of params) {
    console.log(\`\${key}: \${decodeURIComponent(value)}\`);
}
"
```

## –ü—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–∫–∏ "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å"

### 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `do`
- ‚ùå **–ë—ã–ª–æ:** `do=pay` - –ü—Ä–æ–¥–∞–º—É—Å –Ω–µ –ø–æ–Ω–∏–º–∞–ª —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä
- ‚úÖ **–°—Ç–∞–ª–æ:** `do=link` - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏

### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚ùå **–ë—ã–ª–æ:** `client_email`, `success_url`, `failure_url`, `custom_fields`
- ‚úÖ **–°—Ç–∞–ª–æ:** `customer_email`, `urlSuccess`, `urlReturn`, `customer_extra`

### 3. –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API
- ‚ùå **–ë—ã–ª–æ:** HTTP –∑–∞–ø—Ä–æ—Å –∫ API –ü—Ä–æ–¥–∞–º—É—Å
- ‚úÖ **–°—Ç–∞–ª–æ:** –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –≤—Ä—É—á–Ω—É—é

## –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ü—Ä–æ–¥–∞–º—É—Å

### –ü—Ä–∏–º–µ—Ä –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

```php
$data = [
    'order_id' => '',
    'customer_phone' => '+79278820060',
    'customer_email' => '[email protected]',
    'subscription' => 1,
    'vk_user_id' => 12345,
    'vk_user_name' => '–§–∞–º–∏–ª–∏—è –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ',
    'customer_extra' => '',
    'do' => 'link',  // ‚Üê –ö–ª—é—á–µ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä
    'urlReturn' => 'https://demo.payform.ru/demo-return',
    'urlSuccess' => 'https://demo.payform.ru/demo-success',
    'sys' => 'getcourse',
    // ...
];
```

### –ù–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```javascript
const data = {
    do: 'link',                    // ‚úÖ –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    sys: this.shopId,             // ‚úÖ ID –º–∞–≥–∞–∑–∏–Ω–∞
    order_id: orderId,            // ‚úÖ –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞
    amount: amount,                // ‚úÖ –°—É–º–º–∞
    currency: 'RUB',              // ‚úÖ –í–∞–ª—é—Ç–∞
    description: description,      // ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ
    customer_email: `${userId}@telegram.user`,  // ‚úÖ Email –∫–ª–∏–µ–Ω—Ç–∞
    urlReturn: `${process.env.WEBHOOK_URL}/success`,    // ‚úÖ URL –≤–æ–∑–≤—Ä–∞—Ç–∞
    urlSuccess: `${process.env.WEBHOOK_URL}/success`,   // ‚úÖ URL —É—Å–ø–µ—Ö–∞
    webhook_url: process.env.PRODAMUS_WEBHOOK_URL,       // ‚úÖ Webhook
    customer_extra: JSON.stringify({                     // ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
        telegram_user_id: userId
    })
};
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `do=link`
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### 2. –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å"
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ "–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∏"
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –ü—Ä–æ–¥–∞–º—É—Å

### 3. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ Webhook'–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –í—Å–µ–≥–¥–∞ —Å–ª–µ–¥—É–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –ò–∑—É—á–∞–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### 2. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
- –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Å—ã–ª–∫–∏
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ webhook'–∏
- –í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –ø–æ–¥–ø–∏—Å–∏

### 3. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É
- –õ–æ–≥–∏—Ä—É–π—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å" —Ä–µ—à–µ–Ω–æ –ø—É—Ç–µ–º:

- ‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥** - —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –≤—Ä—É—á–Ω—É—é
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ

–¢–µ–ø–µ—Ä—å —Å—Å—ã–ª–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫—É "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å"! üéâ
