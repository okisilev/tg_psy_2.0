# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –¢–µ—Å—Ç—ã prodamusService.test.js

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Å—Ç—ã –æ–∂–∏–¥–∞–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –±–æ–ª—å—à–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–º –ø–æ–¥—Ö–æ–¥–µ.

**–†–µ—à–µ–Ω–∏–µ:**
- –û–±–Ω–æ–≤–∏–ª–∏ —Ç–µ—Å—Ç—ã –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (—Ç–æ–ª—å–∫–æ `do`, `sys`, `order_id`, `signature`)
- –ò—Å–ø—Ä–∞–≤–∏–ª–∏ —Ç–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫, –∏—Å–ø–æ–ª—å–∑—É—è –º–æ–∫ –º–µ—Ç–æ–¥–∞ `createHmacSignature`

### 2. –¢–µ—Å—Ç—ã bot.test.js

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- `body-parser` –Ω–µ –±—ã–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–º–æ–∫–∞–Ω
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –º–æ–∫–∞–ª–∏—Å—å –¥–ª—è webhook'–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–æ–∫ –¥–ª—è `body-parser`:
  ```javascript
  jest.mock('body-parser', () => ({
      json: jest.fn(() => 'jsonParser'),
      urlencoded: jest.fn(() => 'urlParser')
  }));
  ```
- –ò—Å–ø—Ä–∞–≤–∏–ª–∏ –º–æ–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è webhook'–æ–≤:
  - –ò—Å–ø–æ–ª—å–∑—É–µ–º `ProdamusService.prototype.verifyWebhookSignature` –≤–º–µ—Å—Ç–æ `HmacService`
  - –ò—Å–ø–æ–ª—å–∑—É–µ–º `SubscriptionService.prototype.processPayment`

### 3. –¢–µ—Å—Ç—ã restApi.test.js

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `PRODAMUS_PAYMENT_FORM_URL` –≤ —Ç–µ—Å—Ç–∞—Ö.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `beforeEach`:
  ```javascript
  process.env.PRODAMUS_PAYMENT_FORM_URL = 'https://test-shop.payform.ru/pay';
  ```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

```
Test Suites: 7 passed, 7 total
Tests:       60 passed, 60 total
```

### üìä –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

- **–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** 69.15%
- **–í–µ—Ç–∫–∏:** 52.38%
- **–§—É–Ω–∫—Ü–∏–∏:** 65.57%
- **–°—Ç—Ä–æ–∫–∏:** 70.29%

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### 1. Unit —Ç–µ—Å—Ç—ã
- `prodamusService.test.js` - —Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ –ü—Ä–æ–¥–∞–º—É—Å
- `hmacService.test.js` - —Ç–µ—Å—Ç—ã HMAC –ø–æ–¥–ø–∏—Å–∏
- `subscriptionService.test.js` - —Ç–µ—Å—Ç—ã –ø–æ–¥–ø–∏—Å–æ–∫
- `botHandlers.test.js` - —Ç–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –±–æ—Ç–∞

### 2. Integration —Ç–µ—Å—Ç—ã
- `integration.test.js` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `bot.test.js` - —Ç–µ—Å—Ç—ã –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞
- `restApi.test.js` - —Ç–µ—Å—Ç—ã REST API

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –í—Å–µ —Ç–µ—Å—Ç—ã
```bash
npm test
```

### –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª
```bash
npm test -- prodamusService.test.js
```

### –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
```bash
npm run test:coverage
```

### –í —Ä–µ–∂–∏–º–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
```bash
npm run test:watch
```

## –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. REST API —Ç–µ—Å—Ç—ã
- –¢–µ—Å—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ —á–µ—Ä–µ–∑ REST API
- –¢–µ—Å—Ç—ã –∞–∫—Ç–∏–≤–∞—Ü–∏–∏/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–æ–∫
- –¢–µ—Å—Ç—ã –æ—Ç–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 2. –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
- –¢–µ—Å—Ç—ã –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –¢–µ—Å—Ç—ã HMAC –ø–æ–¥–ø–∏—Å–∏
- –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
- –í—Å–µ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `npm run test:watch` –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤
- –°–ª–µ–¥—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
- –ú–æ–∫–∞–π—Ç–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–∞–∫ —É—Å–ø–µ—à–Ω—ã–µ, —Ç–∞–∫ –∏ –æ—à–∏–±–æ—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 3. –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `console.log` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –º–æ–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ —Ç–µ—Å—Ç—ã —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ! –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–π
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É REST API

–¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ü—Ä–æ–¥–∞–º—É—Å.
